<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gael & Mar ‚ù§Ô∏è Hub</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --gael: #007bff; --mar: #ff4d6d; --bg: #fff5f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; color: #b91d47; display: flex; flex-direction: column; align-items: center; }
        
        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; box-sizing: border-box; padding: 20px; }
        .active { display: flex; }
        
        .header { background: var(--mar); color: white; padding: 15px; border-radius: 0 0 25px 25px; width: 100%; position: absolute; top: 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .btn { background: var(--mar); color: white; border: none; padding: 15px; margin: 8px; border-radius: 20px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 5px 0 #d93654; cursor: pointer; width: 85%; max-width: 300px; }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #d93654; }

        /* Estilo Gato */
        .gato-grid { display: grid; grid-template-columns: repeat(3, 90px); gap: 12px; margin: 20px 0; }
        .cell { width: 90px; height: 90px; background: white; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }

        /* Estilo Memorama Mejorado */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 75px); gap: 10px; perspective: 1000px; margin-top: 20px; }
        .card { width: 75px; height: 75px; position: relative; transform-style: preserve-3d; transition: transform 0.5s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { opacity: 0.3; pointer-events: none; transform: rotateY(180deg) scale(0.9); transition: 0.5s; }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 2rem; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); background: white; border: 2px solid #eee; }
        .card-back { transform: rotateY(180deg); background: #fff; border-color: var(--mar); }
        .card-front { background: linear-gradient(45deg, var(--mar), #ff8fa3); color: white; font-size: 1.5rem; font-weight: bold; }

        .timer-box { background: white; padding: 15px; border-radius: 20px; margin-top: 60px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; width: 80%; }
    </style>
</head>
<body>

    <div id="login" class="screen active">
        <h1 style="font-size: 2.5rem;">ü¶Å Gael & Mar üê®</h1>
        <button class="btn" style="background: var(--gael); box-shadow: 0 5px 0 #0056b3;" onclick="setUser('gael')">Soy Gael</button>
        <button class="btn" onclick="setUser('mar')">Soy Mar</button>
    </div>

    <div id="menu" class="screen">
        <div class="header"><h3>‚ù§Ô∏è Nuestro Hub ‚ù§Ô∏è</h3></div>
        <div class="timer-box">
            <small>Llevamos juntos:</small><br>
            <span id="timer" style="font-weight: bold; font-size: 1.2rem;"></span>
        </div>
        <button class="btn" onclick="showScreen('gato')">Jugar al Gato ‚ùå‚≠ï</button>
        <button class="btn" onclick="showScreen('memo')">Memorama ‚ù§Ô∏è</button>
        <button class="btn" style="background:#888; box-shadow: 0 5px 0 #666;" onclick="showScreen('login')">Salir</button>
    </div>

    <div id="gato" class="screen">
        <h2 id="status-gato">Turno: ‚ùå</h2>
        <div class="gato-grid" id="board-gato">
            <script>for(let i=0; i<9; i++) document.write(`<div class="cell" onclick="playGato(${i})"></div>`);</script>
        </div>
        <button class="btn" onclick="resetGato()">Reiniciar</button>
        <button class="btn" style="background:#888; box-shadow:0 5px 0 #666;" onclick="showScreen('menu')">Volver</button>
    </div>

    <div id="memo" class="screen">
        <h2 id="status-memo" style="margin-top: 50px;">Memorama</h2>
        <div class="memory-grid" id="grid-memo"></div>
        <button class="btn" style="margin-top:20px;" onclick="resetMemo()">Mezclar Cartas</button>
        <button class="btn" style="background:#888; box-shadow:0 5px 0 #666;" onclick="showScreen('menu')">Volver</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAHYSY7wUcZ0zPGDXSRgpwDLcN6iTDjg6I",
            authDomain: "minijuego-eabcb.firebaseapp.com",
            projectId: "minijuego-eabcb",
            databaseURL: "https://minijuego-eabcb-default-rtdb.firebaseio.com/",
            storageBucket: "minijuego-eabcb.firebasestorage.app",
            messagingSenderId: "90763304589",
            appId: "1:90763304589:web:91e927504cb88fca6e8cc4"
        };
        firebase.initializeApp(firebaseConfig);
        const dbGato = firebase.database().ref('juego_gato_v3');
        const dbMemo = firebase.database().ref('juego_memo_v3');

        let user = "";
        const emojis = ["‚ù§Ô∏è", "üê±", "üê®", "ü¶Å", "üß∏", "üåπ", "üíé", "üç≠"];

        function setUser(name) { user = name; showScreen('menu'); }
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'memo') initMemo();
        }

        // --- L√ìGICA GATO ---
        function playGato(i) {
            const sym = (user === 'gael') ? "‚ùå" : "‚≠ï";
            dbGato.once('value', s => {
                let d = s.val() || {b: Array(9).fill(""), t: "‚ùå"};
                if (d.b[i] === "" && d.t === sym) {
                    d.b[i] = sym; d.t = (sym === "‚ùå") ? "‚≠ï" : "‚ùå";
                    dbGato.set(d);
                }
            });
        }
        function resetGato() { dbGato.set({b: Array(9).fill(""), t: "‚ùå"}); }
        dbGato.on('value', s => {
            const d = s.val(); if(!d) return;
            const cells = document.querySelectorAll('#board-gato .cell');
            d.b.forEach((v, i) => {
                cells[i].innerText = v;
                cells[i].style.color = (v === "‚ùå") ? "var(--gael)" : "var(--mar)";
            });
            document.getElementById('status-gato').innerText = "Turno: " + d.t;
        });

        // --- L√ìGICA MEMORAMA ---
        function initMemo() {
            dbMemo.on('value', s => {
                let d = s.val();
                if(!d || !d.deck) { resetMemo(); return; }
                
                const grid = document.getElementById('grid-memo');
                grid.innerHTML = '';
                d.deck.forEach((emoji, i) => {
                    const card = document.createElement('div');
                    let isFlipped = (d.f && d.f.includes(i));
                    let isMatched = (d.m && d.m.includes(i));
                    
                    card.className = 'card' + (isFlipped || isMatched ? ' flipped' : '') + (isMatched ? ' matched' : '');
                    card.innerHTML = `<div class="card-face card-front">‚ù§Ô∏è</div><div class="card-face card-back">${emoji}</div>`;
                    card.onclick = () => flipMemo(i);
                    grid.appendChild(card);
                });
                
                if(d.m && d.m.length === 16) document.getElementById('status-memo').innerText = "¬°Ganaron! ‚ù§Ô∏è";
                else document.getElementById('status-memo').innerText = "Memorama";
            });
        }

        function flipMemo(i) {
            dbMemo.once('value', s => {
                let d = s.val();
                if (!d.f) d.f = [];
                if (!d.m) d.m = [];
                if (d.m.includes(i) || d.f.includes(i) || d.f.length >= 2) return;

                d.f.push(i);
                if (d.f.length === 2) {
                    if (d.deck[d.f[0]] === d.deck[d.f[1]]) {
                        d.m.push(d.f[0], d.f[1]);
                        d.f = [];
                    } else {
                        setTimeout(() => { dbMemo.child('f').set([]); }, 1000);
                    }
                }
                dbMemo.set(d);
            });
        }

        function resetMemo() {
            const deck = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
            dbMemo.set({ deck: deck, f: [99], m: [99] }); // Forzar actualizaci√≥n con arrays no vac√≠os
            setTimeout(() => dbMemo.update({f: [], m: []}), 100);
        }

        // TIMER ANIVERSARIO
        const aniversario = new Date("2025-12-31T00:00:00").getTime();
        setInterval(() => {
            const diff = new Date().getTime() - aniversario;
            const d = Math.floor(diff/86400000), h = Math.floor((diff%86400000)/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
            document.getElementById("timer").innerText = `${d}d ${h}h ${m}m ${s}s`;
        }, 1000);
    </script>
</body>
</html>
