<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gael & Mar</title>
    <style>
        :root { --accent: #a29bfe; --bg: #0a0a0a; --card: #161616; --text: #ffffff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; height: 100vh; overflow: hidden; }

        /* Contenedores de Pantallas */
        .view { display: none; height: 100vh; padding: 20px; overflow-y: auto; padding-bottom: 100px; }
        .view.active { display: block; animation: fadeIn 0.3s ease; }

        /* Navegaci√≥n Inferior */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #111; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #222; z-index: 1000; }
        .nav-item { color: #555; font-size: 0.7rem; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; }
        .nav-item.active { color: var(--accent); }

        /* Estilo de Tarjetas */
        .card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid #222; }
        h2 { font-size: 1.4rem; margin: 0 0 10px 0; }

        /* Pizarra Cuadrada */
        .canvas-wrapper { width: 100%; aspect-ratio: 1 / 1; background: white; border-radius: 15px; position: relative; touch-action: none; overflow: hidden; margin-bottom: 15px; }
        canvas { width: 100%; height: 100%; }

        /* Botones */
        .btn { background: var(--accent); color: #000; border: none; padding: 12px 20px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 10px; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid #ff7675; color: #ff7675; margin-top: 10px; }

        /* Animaci√≥n */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Login */
        #login { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 20px; }
    </style>
</head>
<body>

    <div id="login">
        <h1>Gael & Mar</h1>
        <button class="btn" style="width: 200px" onclick="setAppUser('Gael')">Soy Gael</button>
        <button class="btn" style="width: 200px; background: #dcdde1;" onclick="setAppUser('Mar')">Soy Mar</button>
    </div>

    <div id="view-home" class="view active">
        <div class="card" style="text-align: center;">
            <h1 id="user-greeting">Hola</h1>
            <div id="timer" style="font-size: 1.2rem; font-weight: bold; color: var(--accent);">0d 0h 0m 0s</div>
            <p style="opacity: 0.5; font-size: 0.8rem;">Desde el 31 de Dic, 2025</p>
        </div>
        <div class="card">
            <h2>Tags R√°pidos ‚ú®</h2>
            <div id="tags-list" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
            <button class="btn" onclick="createTag()" style="background: #333; color: #fff; margin-top: 15px;">+ Nueva Etiqueta</button>
        </div>
    </div>

    <div id="view-draw" class="view">
        <div class="card">
            <h2>Pizarra M√°gica üé®</h2>
            <div class="canvas-wrapper">
                <canvas id="pizarra"></canvas>
            </div>
            <button class="btn btn-outline" onclick="clearCanvas()">Limpiar para ambos</button>
        </div>
    </div>

    <div id="view-list" class="view">
        <div class="card">
            <h2>Bucket List ‚úàÔ∏è</h2>
            <input type="text" id="listInput" placeholder="A√±adir algo juntos..." style="width:100%; padding:12px; border-radius:10px; border:none; background:#222; color:white;">
            <button class="btn" onclick="addToList()">A√±adir Meta</button>
            <div id="full-list" style="margin-top: 20px;"></div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showView('home')"><span>üè†</span>Inicio</div>
        <div class="nav-item" onclick="showView('draw')"><span>üé®</span>Pizarra</div>
        <div class="nav-item" onclick="showView('list')"><span>‚úÖ</span>Metas</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmChW_AAw3n_gZBZ29rgX8CJonRhooVTE",
            authDomain: "appmar-3bb00.firebaseapp.com",
            databaseURL: "https://appmar-3bb00-default-rtdb.firebaseio.com",
            projectId: "appmar-3bb00",
            storageBucket: "appmar-3bb00.firebasestorage.app",
            messagingSenderId: "762733783465",
            appId: "1:762733783465:web:25a57b8ae450b83ba83cb8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- NAVEGACI√ìN ---
        window.showView = (viewName) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            event.currentTarget.classList.add('active');
            if(viewName === 'draw') resizeCanvas();
        };

        window.setAppUser = (name) => {
            localStorage.setItem('user', name);
            document.getElementById('login').style.display = 'none';
            document.getElementById('user-greeting').innerText = "Hola " + name + " ‚ù§Ô∏è";
        };
        if(localStorage.getItem('user')) setAppUser(localStorage.getItem('user'));

        // --- CONTADOR ---
        setInterval(() => {
            const dif = new Date().getTime() - new Date('2025-12-31T00:00:00').getTime();
            const d = Math.floor(dif/86400000), h = Math.floor((dif%86400000)/3600000), m = Math.floor((dif%3600000)/60000), s = Math.floor((dif%60000)/1000);
            document.getElementById('timer').innerText = `${d}d ${h}h ${m}m ${s}s`;
        }, 1000);

        // --- PIZARRA ---
        const canvas = document.getElementById('pizarra');
        const ctx = canvas.getContext('2d');
        const drawRef = ref(db, 'dibujo');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetWidth;
            ctx.strokeStyle = "#a29bfe"; ctx.lineWidth = 4; ctx.lineCap = "round";
        }

        const sendPoint = (e, type) => {
            const rect = canvas.getBoundingClientRect();
            const x = ((e.touches ? e.touches[0].clientX : e.clientX) - rect.left) / canvas.width;
            const y = ((e.touches ? e.touches[0].clientY : e.clientY) - rect.top) / canvas.height;
            push(drawRef, { x, y, type });
        };

        canvas.addEventListener('mousedown', (e) => { canvas.isDrawing = true; sendPoint(e, 'start'); });
        canvas.addEventListener('mousemove', (e) => { if(canvas.isDrawing) sendPoint(e, 'move'); });
        canvas.addEventListener('touchstart', (e) => { canvas.isDrawing = true; sendPoint(e, 'start'); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if(canvas.isDrawing) { e.preventDefault(); sendPoint(e, 'move'); } }, {passive: false});
        window.addEventListener('mouseup', () => canvas.isDrawing = false);
        window.addEventListener('touchend', () => canvas.isDrawing = false);

        onValue(drawRef, (snap) => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            snap.forEach(child => {
                const p = child.val();
                if(p.type === 'start') { ctx.beginPath(); ctx.moveTo(p.x*canvas.width, p.y*canvas.height); }
                else { ctx.lineTo(p.x*canvas.width, p.y*canvas.height); ctx.stroke(); }
            });
        });

        window.clearCanvas = () => remove(drawRef);

        // --- BUCKET LIST ---
        window.addToList = () => {
            const val = document.getElementById('listInput').value;
            if(val) push(ref(db, 'lista'), { text: val, done: false });
            document.getElementById('listInput').value = '';
        };

        onChildAdded(ref(db, 'lista'), (snap) => {
            const item = document.createElement('div');
            item.className = 'card';
            item.style.padding = "10px";
            item.innerHTML = `<input type="checkbox" ${snap.val().done ? 'checked' : ''}> <span style="${snap.val().done ? 'text-decoration:line-through; opacity:0.5' : ''}">${snap.val().text}</span>`;
            item.querySelector('input').onchange = (e) => update(ref(db, 'lista/'+snap.key), { done: e.target.checked });
            document.getElementById('full-list').prepend(item);
        });

        // --- TAGS ---
        window.createTag = () => {
            const t = prompt("Nueva etiqueta:");
            if(t) push(ref(db, 'tags'), { text: t });
        };
        onChildAdded(ref(db, 'tags'), (snap) => {
            const b = document.createElement('button');
            b.className = 'btn'; b.style.width = 'auto'; b.innerText = snap.val().text;
            b.onclick = () => alert("Notificaci√≥n enviada!");
            document.getElementById('tags-list').appendChild(b);
        });

    </script>
</body>
</html>
